<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-wdith, inital-scale=1" />
        <title>å°åŒ—å¸‚åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚ç¢ºè¨ºæ¡ˆä¾‹å±…ä½åˆ†ä½ˆåœ°åœ–</title>
        <style>
img#map {
    width: 95vw;
}

div#map-image {
    width: 95vw;
    height: 95vw;
    background-image: url("./maps/tpe-covid-map-20210530.jpeg");
    background-size: cover;
}

div#map {
    position: relative;
    top: 28.64583%;
    left: 4.6875%;
    height: 64.7916%;
    width: 91.0416%;
}

div#me {
    display: inline;
    opacity: 0;
    position: relative;
}
        </style>
    </head>
    <body>
        <h1>å°åŒ—å¸‚åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚ç¢ºè¨ºæ¡ˆä¾‹å±…ä½åˆ†ä½ˆåœ°åœ–</h1>
        <p id="message"</p>
        <div id="map-image">
            <div id="map">
                <div id="me">ğŸ˜·</div>
            </div>
        </div>

<script>
let messageElement = document.querySelector("p#message");
let meDiv = document.querySelector("div#me");
let mapDiv = document.querySelector("div#map");

let minLat = 24.975049;
let maxLat = 25.157356;
let minLng = 121.430959;
let maxLng = 121.715074;

if (!navigator.geolocation) {
    messageElement.innerText = "æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚";
} else {
    messageElement.innerText = "æ­£åœ¨å˜—è©¦ç²å–æ‚¨çš„ä½ç½®ã€‚";
    navigator.geolocation.getCurrentPosition((position) => {
        if (position.coords) {
            let lat = position.coords.latitude;
            let lng = position.coords.longitude;

            if (lat >= minLat && lat <= maxLat && lng >= minLng && lng <= maxLng) {
                messageElement.innerText = "æ‚¨çš„ä½ç½®ä½æ–¼åœ°åœ–å…§ï¼Œè«‹æŸ¥çœ‹åœ°åœ–å…§çš„ã€ŒğŸ˜·ã€ä½ç½®ã€‚";

                let w = mapDiv.offsetWidth;
                let h = mapDiv.offsetHeight;
                let y = h * (1.0 - ((lat - minLat)/(maxLat - minLat)));
                let x = w * (lng - minLng)/(maxLng - minLng);

                meDiv.style.opacity = 1;
                let meW = meDiv.offsetWidth;
                let meH = meDiv.offsetHeight;

                x = Math.max(x - (meW/2.0), 0);
                y = Math.max(y - (meH/2.0), 0);
 
                meDiv.style.top = `${y}px`;
                meDiv.style.left = `${x}px`;

            } else {
                messageElement.innerText = "æ‚¨çš„ä½ç½®ä¸¦ä¸åœ¨åœ°åœ–ç¯„åœå…§ã€‚";
            }
        } else {
            messageElement.innerText = "å¾ˆæŠ±æ­‰ç„¡æ³•å–å¾—æ‚¨çš„ä½ç½®ã€‚";
        }
    }, () => {
        messageElement.innerText = "å¾ˆæŠ±æ­‰ç„¡æ³•å–å¾—æ‚¨çš„ä½ç½®ã€‚";
    });
}
</script>
    </body>
</html>
